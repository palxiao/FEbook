《你还在到处找图片预览插件吗？不如自己写一个吧！》

## 前言

本文带大家了解**图片预览**背后的原理，以及如何手写一个简单的预览。

## 打开蒙层

我们先写好一个图片列表，并绑定好点击事件，当点击图片时，通过 `document.createElement` 创建元素，然后把图片节点**克隆**进蒙层中，这一步并不难，简单实现一下。

```css
/* 图片预览样式 */
.modal {
  touch-action: none;
  user-select: none;
  position: fixed;
  z-index: 99;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.75);
}
.modal > img {
  position: absolute;
  padding: 0;
  margin: 0;
  transform: translateZ(0);
}
```

```js
// 点击时存一下相关的节点
originalEl = e.target // 原始图片
cloneEl = originalEl.cloneNode(true) // 克隆图片
originalEl.style.opacity = 0
openPreview() // 打开预览

// ........ 省略 .......

function openPreview() {
  // 创建蒙层
  const mask = document.createElement('div')
  mask.classList.add('modal')
  // 添加在body下
  document.body.appendChild(mask)
  // 注册蒙层的点击事件
  const clickFunc = function () {
    document.body.removeChild(this)
    originalEl.style.opacity = 1
    mask.removeEventListener('click', clickFunc)
  }
  mask.addEventListener("click", clickFunc)
  // 添加图片
  mask.appendChild(cloneEl)
}

// 用于修改样式，减少回流重绘
function changeStyle(el, arr) {
  const original = el.style.cssText.split(';')
  original.pop()
  el.style.cssText = original.concat(arr).join(';') + ';'
}
```

这时候我们成功添加一个**打开预览**的蒙层效果了，但克隆出来的图片位置是没有指定的，此时需要用 `getBoundingClientRect()` 方法获取一下元素相对于**可视窗口**的距离，设置为图片的**起始位置**。

```js
// ......
// 添加图片
const { top, left } = originalEl.getBoundingClientRect()
changeStyle(cloneEl, [`left: ${left}px`, `top: ${top}px`])
mask.appendChild(cloneEl)
```

效果如下，有种点击高亮图片的感觉：

![](../images/0.4937476288336604.gif)

接下来我们需要实现焦点放大的效果，

![](../images/0.4946000014989209.png)

![](../images/0.9925957461956469.gif)

## 图片缩放（PC）


![](../images/0.4981238932697214.gif)



## 移动查看


## 双指缩放（移动端）




