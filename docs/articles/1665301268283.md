
## 一点微小的工作



## 瀑布流排版

瀑布流是一种经典的图片排列模式，其特点是**等宽不等高**，在保持原图比例下显示布局。

目前并没有纯**CSS**可以完美实现的瀑布流方法，常见的**多列布局**(multi-columns)实际效果非常差强人意，它会得到如下的一个竖排布局效果，在实际应用中会感觉图片是乱序排列的。

![](../images/0.2810012945735676.png)

其实用**JS**实现并不难，我们使用绝对定位布局，图片的宽度是平均分布的，只需要计算出图片的高度及`left`、`top`定位对应设置到图片元素上即可：

```html
<template>
    <div :style="{ position: 'absolute', width: `${img.w}px`, height: `${img.h}px`, left: `${img.left}px`, top: `${img.top}px` }" v-for="(img, i) in list" :index="i" :key="'img' + i">
      <img ............ />
    </div>
</template>
```

我们用变量`columnNums`表示有多少列，`gap`表示图片间隔，容器总宽度可以由当前的**DOM**往父级查询`parentNode.offsetWidth`来获取，那么图片在布局中的宽高以及`left`值就可以计算出来了，而高度则用一个数组`columnHeights`来储存，有多少列就往里存多少个元素，随着图片列表的循环一直累加取出计算就可以得到每张图片的`top`定位了，几行代码搞定：

```js
let columnNums = 2 // 有多少列
const gap = 8 // 图片之间的间隔

  const columnHeights: any = [] // 列的高度
  let { offsetWidth: pW } = state.listEl.parentNode
  pW -= gap * (columnNums - 1) // 总体宽度数值等于减去间隔
  const newList = JSON.parse(JSON.stringify(data))
  for (let i = 0; i < newList.length; i++) {
    let index = i % columnNums
    const item = newList[i]
    const ratio = pW / columnNums / item.width
    item.w = pW / columnNums
    item.h = item.height * ratio
    item.left = index * (pW / columnNums + gap)
    item.top = columnHeights[index] + gap || 0
    columnHeights[index] = isNaN(columnHeights[index]) ? item.h : item.h + columnHeights[index] + gap
  }
```

## 书架流排版
## 懒加载
## 图片预览
## node生成缩略图
## 生成预载占位颜色